<div class="min-h-screen bg-gray-50">
  <div class="container mx-auto px-4 py-6 max-w-7xl">
    
    <!-- Page Header -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
      <div>
        <h1 class="text-3xl font-bold text-gray-900 mb-2">Invoice Settlements</h1>
        <p class="text-gray-600">Manage and track invoice payments and installments</p>
      </div>
      <button mat-raised-button color="primary" (click)="toggleAddForm()" class="mt-4 md:mt-0">
        <mat-icon class="mr-2">{{showAddForm ? 'close' : 'add'}}</mat-icon>
        {{showAddForm ? 'Cancel' : 'Record Settlement'}}
      </button>
    </div>

    <!-- Add Settlement Form -->
    <mat-card *ngIf="showAddForm" class="mb-6 shadow-lg">
      <mat-card-header class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-t-lg -mx-6 -mt-6 px-6 py-4 mb-6">
        <mat-card-title class="flex items-center text-blue-900">
          <mat-icon class="mr-3">payment</mat-icon>
          Record New Settlement
        </mat-card-title>
      </mat-card-header>

      <mat-card-content>
        <form [formGroup]="settlementForm" (ngSubmit)="saveSettlement()" class="space-y-6">
          
          <!-- Invoice Selection -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Invoice Selection Button/Display -->
            <div class="w-full">
              <div *ngIf="!selectedInvoice">
                <button type="button" mat-raised-button color="primary" (click)="openInvoiceModal()" class="w-full h-14">
                  <mat-icon class="mr-2">search</mat-icon>
                  Search & Select Invoice
                </button>
                <p class="text-sm text-red-600 mt-2" *ngIf="settlementForm.get('invoiceId')?.invalid && settlementForm.get('invoiceId')?.touched">
                  Please select an invoice
                </p>
              </div>
              
              <!-- Selected Invoice Display -->
              <div *ngIf="selectedInvoice" class="p-4 bg-gradient-to-r from-blue-50 to-blue-100 border-2 border-blue-300 rounded-lg">
                <div class="flex justify-between items-start mb-2">
                  <h4 class="font-semibold text-blue-900">Selected Invoice</h4>
                  <button type="button" mat-icon-button color="warn" (click)="clearSelectedInvoice()" matTooltip="Clear selection">
                    <mat-icon>close</mat-icon>
                  </button>
                </div>
                <div class="space-y-1">
                  <p class="text-sm"><span class="font-medium">Invoice:</span> {{selectedInvoice.invoiceNumber}}</p>
                  <p class="text-sm"><span class="font-medium">Client:</span> {{selectedInvoice.clientName}}</p>
                  <p class="text-sm"><span class="font-medium">Status:</span> 
                    <mat-chip [color]="getStatusColor(selectedInvoice.status)" [selected]="true" class="text-xs ml-2">
                      {{selectedInvoice.status | titlecase}}
                    </mat-chip>
                  </p>
                  <p class="text-sm"><span class="font-medium text-orange-600">Remaining:</span> 
                    <span class="font-bold text-orange-900">${{selectedInvoice.remainingAmount | number:'1.2-2'}}</span>
                  </p>
                </div>
              </div>
            </div>

            <mat-form-field appearance="fill" class="w-full">
              <mat-label>Settlement Date</mat-label>
              <input matInput [matDatepicker]="settlementDatePicker" formControlName="settlementDate">
              <mat-datepicker-toggle matSuffix [for]="settlementDatePicker"></mat-datepicker-toggle>
              <mat-datepicker #settlementDatePicker></mat-datepicker>
            </mat-form-field>
          </div>

          <!-- Selected Invoice Details -->
          <div *ngIf="selectedInvoice" class="p-4 bg-gradient-to-r from-blue-50 to-blue-100 border border-blue-200 rounded-lg">
            <h3 class="text-sm font-semibold text-blue-900 mb-3">Invoice Details</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
              <div>
                <p class="text-blue-600 font-medium">Total Amount</p>
                <p class="text-gray-900 font-bold">${{selectedInvoice.totalAmount | number:'1.2-2'}}</p>
              </div>
              <div>
                <p class="text-blue-600 font-medium">Already Settled</p>
                <p class="text-gray-900 font-bold">${{selectedInvoice.amountSettled | number:'1.2-2'}}</p>
              </div>
              <div>
                <p class="text-orange-600 font-medium">Remaining Balance</p>
                <p class="text-orange-900 font-bold text-lg">${{selectedInvoice.remainingAmount | number:'1.2-2'}}</p>
              </div>
              <div>
                <p class="text-blue-600 font-medium">Status</p>
                <mat-chip [color]="getStatusColor(selectedInvoice.status)" [selected]="true" class="text-xs">
                  {{selectedInvoice.status | titlecase}}
                </mat-chip>
              </div>
            </div>
          </div>

          <!-- Payment Details -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <mat-form-field appearance="fill" class="w-full">
              <mat-label>Settlement Amount</mat-label>
              <input matInput type="number" formControlName="settlementAmount" step="0.01" min="0.01"
                     [max]="selectedInvoice?.remainingAmount || 999999">
              <span matPrefix>$ &nbsp;</span>
              <mat-icon matSuffix>attach_money</mat-icon>
              <mat-hint *ngIf="selectedInvoice">
                Maximum: ${{selectedInvoice.remainingAmount | number:'1.2-2'}}
              </mat-hint>
              <mat-error *ngIf="settlementForm.get('settlementAmount')?.hasError('required')">
                Amount is required
              </mat-error>
              <mat-error *ngIf="settlementForm.get('settlementAmount')?.hasError('min')">
                Amount must be greater than $0
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="fill" class="w-full">
              <mat-label>Payment Method</mat-label>
              <mat-select formControlName="paymentMethod">
                <mat-option *ngFor="let method of paymentMethods" [value]="method.value">
                  <mat-icon class="align-middle mr-2">{{method.icon}}</mat-icon>
                  {{method.label}}
                </mat-option>
              </mat-select>
              <mat-icon matSuffix>payment</mat-icon>
            </mat-form-field>
          </div>

          <!-- Dynamic Payment Method-Specific Fields -->
          <div *ngIf="settlementForm.get('paymentMethod')?.value === 'card'" 
               class="grid grid-cols-1 md:grid-cols-2 gap-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
            <mat-form-field appearance="fill" class="w-full">
              <mat-label>Card Last 4 Digits</mat-label>
              <input matInput formControlName="cardLast4" maxlength="4" placeholder="1234">
              <mat-icon matSuffix>credit_card</mat-icon>
              <mat-error *ngIf="settlementForm.get('cardLast4')?.hasError('required')">
                Required
              </mat-error>
              <mat-error *ngIf="settlementForm.get('cardLast4')?.hasError('pattern')">
                Must be 4 digits
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="fill" class="w-full">
              <mat-label>Card Type</mat-label>
              <mat-select formControlName="cardType">
                <mat-option *ngFor="let type of getCardTypes()" [value]="type.value">
                  {{type.label}}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="settlementForm.get('cardType')?.hasError('required')">
                Required
              </mat-error>
            </mat-form-field>
          </div>

          <div *ngIf="settlementForm.get('paymentMethod')?.value === 'transfer'" 
               class="grid grid-cols-1 md:grid-cols-2 gap-6 p-4 bg-purple-50 border border-purple-200 rounded-lg">
            <mat-form-field appearance="fill" class="w-full">
              <mat-label>Bank Name</mat-label>
              <input matInput formControlName="bankName">
              <mat-icon matSuffix>account_balance</mat-icon>
              <mat-error *ngIf="settlementForm.get('bankName')?.hasError('required')">
                Required
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="fill" class="w-full">
              <mat-label>Account Last 4 Digits (Optional)</mat-label>
              <input matInput formControlName="accountLast4" maxlength="4">
              <mat-icon matSuffix>tag</mat-icon>
              <mat-error *ngIf="settlementForm.get('accountLast4')?.hasError('pattern')">
                Must be 4 digits
              </mat-error>
            </mat-form-field>
          </div>

          <div *ngIf="settlementForm.get('paymentMethod')?.value === 'check'" 
               class="grid grid-cols-1 md:grid-cols-2 gap-6 p-4 bg-green-50 border border-green-200 rounded-lg">
            <mat-form-field appearance="fill" class="w-full">
              <mat-label>Check Number</mat-label>
              <input matInput formControlName="checkNumber">
              <mat-icon matSuffix>receipt_long</mat-icon>
              <mat-error *ngIf="settlementForm.get('checkNumber')?.hasError('required')">
                Required
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="fill" class="w-full">
              <mat-label>Bank Name</mat-label>
              <input matInput formControlName="bankName">
              <mat-icon matSuffix>account_balance</mat-icon>
              <mat-error *ngIf="settlementForm.get('bankName')?.hasError('required')">
                Required
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="fill" class="w-full">
              <mat-label>Check Date (Optional)</mat-label>
              <input matInput [matDatepicker]="checkDatePicker" formControlName="checkDate">
              <mat-datepicker-toggle matSuffix [for]="checkDatePicker"></mat-datepicker-toggle>
              <mat-datepicker #checkDatePicker></mat-datepicker>
            </mat-form-field>
          </div>

          <div *ngIf="settlementForm.get('paymentMethod')?.value === 'money'" 
               class="grid grid-cols-1 md:grid-cols-2 gap-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
            <mat-form-field appearance="fill" class="w-full">
              <mat-label>Transaction ID</mat-label>
              <input matInput formControlName="transactionId">
              <mat-icon matSuffix>confirmation_number</mat-icon>
              <mat-error *ngIf="settlementForm.get('transactionId')?.hasError('required')">
                Required
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="fill" class="w-full">
              <mat-label>Phone Number</mat-label>
              <input matInput formControlName="phoneNumber" placeholder="+1234567890">
              <mat-icon matSuffix>phone</mat-icon>
              <mat-error *ngIf="settlementForm.get('phoneNumber')?.hasError('required')">
                Required
              </mat-error>
              <mat-error *ngIf="settlementForm.get('phoneNumber')?.hasError('pattern')">
                Invalid phone number
              </mat-error>
            </mat-form-field>
          </div>

          <!-- Reference & Notes -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <mat-form-field appearance="fill" class="w-full">
              <mat-label>Reference Number (Optional)</mat-label>
              <input matInput formControlName="referenceNumber">
              <mat-icon matSuffix>tag</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="fill" class="w-full">
              <mat-label>Notes (Optional)</mat-label>
              <textarea matInput formControlName="notes" rows="2"></textarea>
              <mat-icon matSuffix>note</mat-icon>
            </mat-form-field>
          </div>

          <!-- Action Buttons -->
          <div class="flex justify-end gap-3 pt-4 border-t border-gray-200">
            <button mat-stroked-button type="button" (click)="toggleAddForm()" [disabled]="loading">
              <mat-icon class="mr-2">close</mat-icon>
              Cancel
            </button>
            <button mat-flat-button color="primary" type="submit" [disabled]="settlementForm.invalid || loading">
              <mat-icon class="mr-2">save</mat-icon>
              {{loading ? 'Saving...' : 'Save Settlement'}}
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>

    <!-- Settlements Table -->
    <mat-card class="shadow-lg">
      <mat-card-content>
        <!-- Loading Spinner -->
        <div *ngIf="loading && settlements.length === 0" class="text-center py-12">
          <mat-spinner diameter="50" class="mx-auto mb-4"></mat-spinner>
          <p class="text-gray-600">Loading settlements...</p>
        </div>

        <!-- Empty State -->
        <div *ngIf="!loading && settlements.length === 0" class="text-center py-12">
          <mat-icon class="text-6xl text-gray-300 mb-4">payment</mat-icon>
          <p class="text-xl font-medium text-gray-600 mb-2">No Settlements Yet</p>
          <p class="text-gray-500">Start recording invoice payments to see them here</p>
        </div>

        <!-- Settlements Table (Desktop) -->
        <div *ngIf="settlements.length > 0" class="overflow-x-auto hidden md:block">
          <table mat-table [dataSource]="dataSource" class="w-full">
            
            <!-- Settlement Date Column -->
            <ng-container matColumnDef="settlementDate">
              <th mat-header-cell *matHeaderCellDef class="font-semibold">Date</th>
              <td mat-cell *matCellDef="let element">
                <div class="flex items-center">
                  <mat-icon class="text-blue-600 mr-2 text-sm">event</mat-icon>
                  {{formatDate(element.settlementDate)}}
                </div>
              </td>
            </ng-container>

            <!-- Invoice Number Column -->
            <ng-container matColumnDef="invoiceNumber">
              <th mat-header-cell *matHeaderCellDef class="font-semibold">Invoice</th>
              <td mat-cell *matCellDef="let element">
                <div class="flex items-center">
                  <mat-icon class="text-gray-600 mr-2 text-sm">receipt</mat-icon>
                  <span class="font-mono font-medium">{{element.invoiceNumber}}</span>
                </div>
              </td>
            </ng-container>

            <!-- Client Name Column -->
            <ng-container matColumnDef="clientName">
              <th mat-header-cell *matHeaderCellDef class="font-semibold">Client</th>
              <td mat-cell *matCellDef="let element">
                <div class="flex items-center">
                  <mat-icon class="text-purple-600 mr-2 text-sm">person</mat-icon>
                  {{element.clientName}}
                </div>
              </td>
            </ng-container>

            <!-- Settlement Amount Column -->
            <ng-container matColumnDef="settlementAmount">
              <th mat-header-cell *matHeaderCellDef class="font-semibold text-right">Amount Paid</th>
              <td mat-cell *matCellDef="let element" class="text-right">
                <span class="text-green-600 font-bold text-lg">${{element.settlementAmount | number:'1.2-2'}}</span>
              </td>
            </ng-container>

            <!-- Payment Method Column -->
            <ng-container matColumnDef="paymentMethod">
              <th mat-header-cell *matHeaderCellDef class="font-semibold">Method</th>
              <td mat-cell *matCellDef="let element">
                <div class="flex items-center">
                  <mat-icon class="text-blue-600 mr-2 text-sm">{{getPaymentMethodIcon(element.paymentMethod)}}</mat-icon>
                  <span class="capitalize">{{element.paymentMethod}}</span>
                </div>
              </td>
            </ng-container>

            <!-- Remaining Balance Column -->
            <ng-container matColumnDef="remainingBalance">
              <th mat-header-cell *matHeaderCellDef class="font-semibold text-right">Remaining</th>
              <td mat-cell *matCellDef="let element" class="text-right">
                <span class="font-bold" [ngClass]="{
                  'text-green-600': (element.invoiceRemainingAmount || 0) === 0,
                  'text-orange-600': (element.invoiceRemainingAmount || 0) > 0
                }">
                  ${{element.invoiceRemainingAmount | number:'1.2-2'}}
                </span>
              </td>
            </ng-container>

            <!-- Invoice Status Column -->
            <ng-container matColumnDef="invoiceStatus">
              <th mat-header-cell *matHeaderCellDef class="font-semibold">Status</th>
              <td mat-cell *matCellDef="let element">
                <mat-chip [color]="getStatusColor(element.invoiceStatus)" [selected]="true" class="text-xs">
                  {{element.invoiceStatus | titlecase}}
                </mat-chip>
              </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef class="font-semibold text-center">Actions</th>
              <td mat-cell *matCellDef="let element" class="text-center">
                <button mat-icon-button [matMenuTriggerFor]="actionsMenu" matTooltip="Actions">
                  <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #actionsMenu="matMenu">
                  <button mat-menu-item (click)="viewReceipt(element)">
                    <mat-icon class="text-blue-600">visibility</mat-icon>
                    <span>View Receipt</span>
                  </button>
                  <button mat-menu-item (click)="downloadReceipt(element)">
                    <mat-icon class="text-green-600">download</mat-icon>
                    <span>Download PDF</span>
                  </button>
                  <button mat-menu-item (click)="printReceipt(element)">
                    <mat-icon class="text-purple-600">print</mat-icon>
                    <span>Print Receipt</span>
                  </button>
                  <mat-divider></mat-divider>
                  <button mat-menu-item (click)="deleteSettlement(element)">
                    <mat-icon class="text-red-600">delete</mat-icon>
                    <span>Delete Settlement</span>
                  </button>
                </mat-menu>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" 
                class="hover:bg-gray-50 transition-colors"></tr>
          </table>

          <!-- Paginator -->
          <mat-paginator [length]="getTotalSettlements()"
                         [pageSize]="10"
                         [pageSizeOptions]="[10, 25, 50, 100]" 
                         showFirstLastButtons
                         class="border-t border-gray-200">
          </mat-paginator>
        </div>

        <!-- Mobile Card View -->
        <div *ngIf="settlements.length > 0" class="md:hidden space-y-4">
          <div *ngFor="let settlement of getPaginatedMobileData()" 
               class="border border-gray-200 rounded-lg p-4 bg-white shadow-sm hover:shadow-md transition-shadow">
            
            <!-- Header -->
            <div class="flex justify-between items-start mb-3 pb-3 border-b border-gray-100">
              <div class="flex-1">
                <div class="flex items-center text-sm text-gray-600 mb-1">
                  <mat-icon class="text-blue-600 mr-1 text-sm">event</mat-icon>
                  {{formatDate(settlement.settlementDate)}}
                </div>
                <div class="flex items-center font-mono font-semibold text-gray-900">
                  <mat-icon class="text-gray-600 mr-1 text-sm">receipt</mat-icon>
                  {{settlement.invoiceNumber}}
                </div>
              </div>
              <button mat-icon-button [matMenuTriggerFor]="mobileActionsMenu">
                <mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #mobileActionsMenu="matMenu">
                <button mat-menu-item (click)="viewReceipt(settlement)">
                  <mat-icon class="text-blue-600">visibility</mat-icon>
                  <span>View Receipt</span>
                </button>
                <button mat-menu-item (click)="downloadReceipt(settlement)">
                  <mat-icon class="text-green-600">download</mat-icon>
                  <span>Download PDF</span>
                </button>
                <button mat-menu-item (click)="printReceipt(settlement)">
                  <mat-icon class="text-purple-600">print</mat-icon>
                  <span>Print Receipt</span>
                </button>
                <mat-divider></mat-divider>
                <button mat-menu-item (click)="deleteSettlement(settlement)">
                  <mat-icon class="text-red-600">delete</mat-icon>
                  <span>Delete</span>
                </button>
              </mat-menu>
            </div>

            <!-- Details Grid -->
            <div class="grid grid-cols-2 gap-3 text-sm">
              <div>
                <p class="text-gray-500 text-xs mb-1">Client</p>
                <div class="flex items-center">
                  <mat-icon class="text-purple-600 mr-1 text-sm">person</mat-icon>
                  <span class="font-medium">{{settlement.clientName}}</span>
                </div>
              </div>

              <div>
                <p class="text-gray-500 text-xs mb-1">Payment Method</p>
                <div class="flex items-center">
                  <mat-icon class="text-blue-600 mr-1 text-sm">{{getPaymentMethodIcon(settlement.paymentMethod)}}</mat-icon>
                  <span class="capitalize">{{settlement.paymentMethod}}</span>
                </div>
              </div>

              <div>
                <p class="text-gray-500 text-xs mb-1">Amount Paid</p>
                <p class="text-green-600 font-bold text-lg">${{settlement.settlementAmount | number:'1.2-2'}}</p>
              </div>

              <div>
                <p class="text-gray-500 text-xs mb-1">Remaining</p>
                <p class="font-bold text-lg" [ngClass]="{
                  'text-green-600': (settlement.invoiceRemainingAmount || 0) === 0,
                  'text-orange-600': (settlement.invoiceRemainingAmount || 0) > 0
                }">
                  ${{settlement.invoiceRemainingAmount | number:'1.2-2'}}
                </p>
              </div>

              <div class="col-span-2">
                <p class="text-gray-500 text-xs mb-1">Status</p>
                <mat-chip [color]="getStatusColor(settlement.invoiceStatus)" [selected]="true" class="text-xs">
                  {{settlement.invoiceStatus | titlecase}}
                </mat-chip>
              </div>
            </div>
          </div>

          <!-- Mobile Paginator -->
          <mat-paginator [length]="getTotalSettlements()"
                         [pageSize]="10"
                         [pageSizeOptions]="[10, 25, 50]"
                         (page)="onMobilePageChange($event)"
                         class="border-t border-gray-200">
          </mat-paginator>
        </div>
      </mat-card-content>
    </mat-card>

  </div>
</div>

<!-- Invoice Search Modal -->
<div *ngIf="showInvoiceModal" class="fixed inset-0 z-50 overflow-hidden flex items-center justify-center bg-black bg-opacity-50" 
     (click)="closeInvoiceModal()">
  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[80vh] flex flex-col m-4" 
       (click)="$event.stopPropagation()">
    
    <!-- Modal Header -->
    <div class="flex justify-between items-center p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-blue-100">
      <div class="flex items-center">
        <mat-icon class="text-blue-600 mr-3">receipt_long</mat-icon>
        <div>
          <h2 class="text-2xl font-bold text-gray-900">Select Invoice</h2>
          <p class="text-sm text-gray-600">Search and select an invoice to settle</p>
        </div>
      </div>
      <button mat-icon-button (click)="closeInvoiceModal()" class="hover:bg-gray-200 rounded-full">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <!-- Search Bar -->
    <div class="p-4 border-b border-gray-200 bg-gray-50">
      <mat-form-field appearance="fill" class="w-full">
        <mat-label>Search invoices</mat-label>
        <input matInput 
               [(ngModel)]="invoiceSearchTerm" 
               (ngModelChange)="onInvoiceSearchChange($event)">
        <mat-icon matPrefix>search</mat-icon>
      </mat-form-field>
    </div>

    <!-- Invoice List -->
    <div class="flex-1 overflow-y-auto p-4" (scroll)="$event.target.scrollTop + $event.target.clientHeight >= $event.target.scrollHeight - 100 && loadMoreInvoices()">
      
      <!-- Loading State -->
      <div *ngIf="isLoadingInvoices && filteredInvoices.length === 0" class="text-center py-12">
        <mat-spinner diameter="50" class="mx-auto mb-4"></mat-spinner>
        <p class="text-gray-600">Loading invoices...</p>
      </div>

      <!-- Empty State -->
      <div *ngIf="!isLoadingInvoices && filteredInvoices.length === 0" class="text-center py-12">
        <mat-icon class="text-6xl text-gray-300 mb-4">receipt</mat-icon>
        <p class="text-xl font-medium text-gray-600 mb-2">No Unpaid Invoices Found</p>
        <p class="text-gray-500">Try adjusting your search or create a new invoice</p>
      </div>

      <!-- Invoice Cards -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div *ngFor="let invoice of filteredInvoices" 
             class="border border-gray-200 rounded-lg p-4 hover:border-blue-400 hover:shadow-lg transition-all cursor-pointer bg-white"
             (click)="selectInvoice(invoice)">
          
          <div class="flex justify-between items-start mb-3">
            <div class="flex-1">
              <h3 class="font-bold text-lg text-gray-900 font-mono">{{invoice.invoiceNumber}}</h3>
              <p class="text-sm text-gray-600 flex items-center mt-1">
                <mat-icon class="text-sm mr-1">person</mat-icon>
                {{invoice.clientName}}
              </p>
            </div>
            <mat-chip [color]="getStatusColor(invoice.status)" [selected]="true" class="text-xs">
              {{invoice.status | titlecase}}
            </mat-chip>
          </div>

          <div class="grid grid-cols-2 gap-2 text-sm border-t border-gray-100 pt-3">
            <div>
              <p class="text-gray-500 text-xs">Total Amount</p>
              <p class="font-semibold text-gray-900">${{invoice.totalAmount | number:'1.2-2'}}</p>
            </div>
            <div>
              <p class="text-gray-500 text-xs">Already Settled</p>
              <p class="font-semibold text-green-600">${{invoice.amountSettled | number:'1.2-2'}}</p>
            </div>
            <div class="col-span-2 border-t border-orange-100 pt-2 mt-2">
              <p class="text-orange-600 text-xs font-medium">Remaining Balance</p>
              <p class="font-bold text-orange-900 text-xl">${{invoice.remainingAmount | number:'1.2-2'}}</p>
            </div>
          </div>

          <div class="mt-3 flex items-center text-xs text-gray-500">
            <mat-icon class="text-xs mr-1">event</mat-icon>
            {{invoice.invoiceDate | date:'MMM d, y'}}
          </div>
        </div>
      </div>

      <!-- Load More Indicator -->
      <div *ngIf="isLoadingInvoices && filteredInvoices.length > 0" class="text-center py-4">
        <mat-spinner diameter="40" class="mx-auto"></mat-spinner>
        <p class="text-sm text-gray-600 mt-2">Loading more invoices...</p>
      </div>

      <!-- End of Results -->
      <div *ngIf="!isLoadingInvoices && !hasMoreInvoices && filteredInvoices.length > 0" class="text-center py-4">
        <p class="text-sm text-gray-500">No more invoices to load</p>
      </div>
    </div>

    <!-- Modal Footer -->
    <div class="p-4 border-t border-gray-200 bg-gray-50">
      <button mat-stroked-button (click)="closeInvoiceModal()" class="w-full md:w-auto">
        <mat-icon class="mr-2">close</mat-icon>
        Cancel
      </button>
    </div>

  </div>
</div>

