<div class="p-6">
  <!-- Header Section -->
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
    <div>
      <h1 class="text-2xl font-bold text-gray-900 mb-2">Stock Alerts & Reorder Management</h1>
      <p class="text-gray-600">Monitor inventory levels and manage reorder suggestions</p>
    </div>
    <div class="flex space-x-2 mt-4 sm:mt-0">
      <button mat-raised-button color="primary" (click)="refreshData()" [disabled]="loading">
        <mat-icon>refresh</mat-icon>
        Refresh
      </button>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
    <mat-card class="text-center">
      <mat-card-content>
        <div class="text-2xl font-bold text-blue-600">{{alertStatistics.total || 0}}</div>
        <div class="text-sm text-gray-600">Total Alerts</div>
      </mat-card-content>
    </mat-card>
    <mat-card class="text-center">
      <mat-card-content>
        <div class="text-2xl font-bold text-red-600">{{alertStatistics.unacknowledged || 0}}</div>
        <div class="text-sm text-gray-600">Unacknowledged</div>
      </mat-card-content>
    </mat-card>
    <mat-card class="text-center">
      <mat-card-content>
        <div class="text-2xl font-bold text-orange-600">{{alertStatistics.highPriority || 0}}</div>
        <div class="text-sm text-gray-600">High Priority</div>
      </mat-card-content>
    </mat-card>
    <mat-card class="text-center">
      <mat-card-content>
        <div class="text-2xl font-bold text-red-600">{{alertStatistics.outOfStock || 0}}</div>
        <div class="text-sm text-gray-600">Out of Stock</div>
      </mat-card-content>
    </mat-card>
  </div>


  <!-- Filters and Controls -->
  <mat-card class="mb-6">
    <mat-card-content>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <mat-form-field appearance="fill" class="w-full">
          <mat-label>Priority</mat-label>
          <mat-select [(value)]="selectedPriority" (selectionChange)="onFilterChange()">
            <mat-option *ngFor="let option of priorityOptions" [value]="option.value">
              {{option.label}}
            </mat-option>
          </mat-select>
        </mat-form-field>
        
        <mat-form-field appearance="fill" class="w-full">
          <mat-label>Type</mat-label>
          <mat-select [(value)]="selectedType" (selectionChange)="onFilterChange()">
            <mat-option *ngFor="let option of typeOptions" [value]="option.value">
              {{option.label}}
            </mat-option>
          </mat-select>
        </mat-form-field>
        
        <mat-form-field appearance="fill" class="w-full">
          <mat-label>Status</mat-label>
          <mat-select [(value)]="selectedStatus" (selectionChange)="onFilterChange()">
            <mat-option *ngFor="let option of statusOptions" [value]="option.value">
              {{option.label}}
            </mat-option>
          </mat-select>
        </mat-form-field>
        
        <mat-form-field appearance="fill" class="w-full">
          <mat-label>Sort By</mat-label>
          <mat-select [(value)]="sortBy" (selectionChange)="onSortChange()">
            <mat-option value="priority">Priority</mat-option>
            <mat-option value="createdAt">Date Created</mat-option>
            <mat-option value="itemName">Item Name</mat-option>
            <mat-option value="currentStock">Current Stock</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Stock Alerts Table -->
  <mat-card>
    <mat-card-header>
      <mat-card-title>Stock Alerts</mat-card-title>
      <mat-card-subtitle>{{filteredAlerts.length}} alerts found</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead>
            <tr class="border-b">
              <th class="text-left py-3 px-4">Item</th>
              <th class="text-left py-3 px-4">Stock Level</th>
              <th class="text-left py-3 px-4">Priority</th>
              <th class="text-left py-3 px-4">Type</th>
              <th class="text-left py-3 px-4">Reorder Suggestion</th>
              <th class="text-left py-3 px-4">Estimated Cost</th>
              <th class="text-left py-3 px-4">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let alert of paginatedAlerts" class="border-b hover:bg-gray-50">
              <td class="py-3 px-4">
                <div class="flex items-center">
                  <!-- Item Image -->
                  <div class="w-12 h-12 rounded-lg overflow-hidden mr-3 bg-gray-100 flex items-center justify-center flex-shrink-0">
                    <img *ngIf="alert.picture && alert.picture.length > 0" 
                         [src]="alert.picture" 
                         alt="{{alert.itemName}}"
                         class="w-full h-full object-cover"
                         (error)="$event.target.src='assets/images/products/speaker-1.jpg'">
                    <mat-icon *ngIf="!alert.picture || alert.picture.length === 0" 
                              class="text-gray-400 text-2xl">inventory_2</mat-icon>
                  </div>
                  <!-- Item Details -->
                  <div>
                    <div class="font-medium">{{alert.itemName}}</div>
                    <div class="text-sm text-gray-600">{{alert.itemCode}}</div>
                    <div class="text-xs text-gray-500" *ngIf="alert.containerCode">
                      Container: {{alert.containerCode}}
                    </div>
                  </div>
                </div>
              </td>
              <td class="py-3 px-4">
                <div>
                  <div class="font-semibold" 
                       [ngClass]="{
                         'text-red-600': alert.currentStock <= 0,
                         'text-orange-600': alert.currentStock > 0 && alert.currentStock <= alert.reorderPoint,
                         'text-green-600': alert.currentStock > alert.reorderPoint
                       }">
                    {{alert.currentStock}} units
                  </div>
                  <div class="text-sm text-gray-600">Min: {{alert.reorderPoint}}</div>
                  <div class="text-xs text-blue-600" *ngIf="alert.daysUntilStockout && alert.daysUntilStockout < 30">
                    {{alert.daysUntilStockout}} days left
                  </div>
                </div>
              </td>
              <td class="py-3 px-4">
                <span class="px-2 py-1 rounded-full text-xs font-medium"
                      [ngClass]="getPriorityColor(alert.priority)">
                  {{alert.priority}}
                </span>
              </td>
              <td class="py-3 px-4">
                <span class="px-2 py-1 rounded-full text-xs font-medium"
                      [ngClass]="getTypeColor(alert.alertType)">
                  {{alert.alertType.replace('_', ' ')}}
                </span>
              </td>
              <td class="py-3 px-4">
                <div>
                  <div class="font-medium text-blue-600">{{alert.suggestedOrderQuantity || 0}} units</div>
                  <div class="text-xs text-gray-500" *ngIf="alert.unitPrice">
                    &#64; ${{alert.unitPrice | number:'1.2-2'}}/unit
                  </div>
                </div>
              </td>
              <td class="py-3 px-4">
                <div class="font-semibold text-green-600">
                  {{formatCurrency(alert.estimatedCost || 0)}}
                </div>
              </td>
              <td class="py-3 px-4">
                <div class="flex space-x-2">
                  <button mat-icon-button 
                          (click)="openAlertDetails(alert)"
                          matTooltip="View Details"
                          color="primary">
                    <mat-icon>visibility</mat-icon>
                  </button>
                  <button mat-icon-button 
                          (click)="acknowledgeAlert(alert)"
                          matTooltip="Acknowledge Alert"
                          color="accent"
                          [disabled]="loading">
                    <mat-icon>check_circle</mat-icon>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
        
        <!-- Empty State -->
        <div *ngIf="filteredAlerts.length === 0 && !loading" class="text-center py-8">
          <mat-icon class="text-6xl text-gray-400 mb-4">inbox</mat-icon>
          <h3 class="text-lg font-medium text-gray-900 mb-2">No alerts found</h3>
          <p class="text-gray-600">No stock alerts match your current filters.</p>
        </div>
        
        <!-- Loading State -->
        <div *ngIf="loading" class="text-center py-8">
          <mat-spinner class="mx-auto" diameter="40"></mat-spinner>
          <p class="text-gray-600 mt-4">Loading stock alerts...</p>
        </div>
      </div>
      
      <!-- Pagination -->
      <div class="flex justify-center items-center p-4 border-t border-gray-200" *ngIf="filteredAlerts.length > 0">
        <mat-paginator 
          [length]="filteredAlerts.length"
          [pageSize]="pageSize"
          [pageSizeOptions]="pageSizeOptions"
          [pageIndex]="currentPage"
          (page)="onPageChange($event)"
          showFirstLastButtons>
        </mat-paginator>
      </div>
    </mat-card-content>
  </mat-card>
</div>
