<div class="page-wrap flex flex-col justify-center items-center !min-h-screen slate">
  <div class="xs:min-w-full sm:min-w-96 min-w-72" [@animate]="{value:'*',params:{y:'40px',opacity:'0',delay:'100ms', duration: '400ms'}}">
    <mat-progress-bar mode="determinate" class="session-progress"></mat-progress-bar>
    <mat-card class="!m-0 sm:h-auto h-screen sm:!rounded-md !rounded-none">
      <mat-card-content>
        <div class="flex flex-col justify-start items-start !py-4">
          <p class="text-xl mb-1 font-bold">Two-Factor Authentication</p>
          <p class="text-secondary">We've sent a 4-digit verification code to your email address</p>
          <p class="text-secondary">for <strong>{{ username }}</strong></p>
        </div>

        <p *ngIf="errorMessage" class="text-center"><small class="text-red">{{errorMessage}}</small></p>

        <form [formGroup]="otpForm" (ngSubmit)="onSubmit()">
          <div class="">
            <mat-form-field class="w-full">
              <input matInput 
                     formControlName="otp" 
                     placeholder="Enter 4-digit code"
                     maxlength="4"
                     type="tel"
                     class="text-center text-2xl tracking-widest">
            </mat-form-field>
            <small
              *ngIf="otpForm.controls['otp'].hasError('required') && otpForm.controls['otp'].touched"
              class="form-error-msg"> Verification code is required </small>
            <small
              *ngIf="otpForm.controls['otp'].hasError('pattern') && otpForm.controls['otp'].touched"
              class="form-error-msg"> Please enter a valid 4-digit code </small>
          </div>

          <button mat-raised-button color="primary" class="w-full mb-4" [disabled]="otpForm.invalid || loading" type="submit">
            <mat-spinner *ngIf="loading" diameter="20" class="mr-2"></mat-spinner>
            <span *ngIf="!loading">Verify Code</span>
            <span *ngIf="loading">Verifying...</span>
          </button>
        </form>

        <div class="w-full">
          <button mat-button class="w-full" (click)="resendOtp()" [disabled]="!canResend || loading">
            Resend Code <span *ngIf="!canResend">({{ countdown }}s)</span>
          </button>
        </div>

        <div class="w-full">
          <button mat-button class="w-full" (click)="backToLogin()" [disabled]="loading">
            Back to Login
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>

